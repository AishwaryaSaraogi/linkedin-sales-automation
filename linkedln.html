<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Sales Automation</title>
    <!-- Use Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .loading-dots::after {
            content: '...';
            animation: loading 1s infinite;
        }
        @keyframes loading {
            0% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main Container -->
    <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">LinkedIn Sales Automation</h1>
        <p class="text-center text-gray-600 mb-8">Generate hyper-personalized outreach messages using AI.</p>

        <!-- Form for Campaign Intake -->
        <div id="setup-form" class="space-y-6">
            <div>
                <label for="productService" class="block text-sm font-medium text-gray-700">Product/Service</label>
                <input type="text" id="productService" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" placeholder="e.g., HR SaaS, Financial Planning Software">
            </div>

            <div>
                <label for="targetIndustry" class="block text-sm font-medium text-gray-700">Target Industry</label>
                <input type="text" id="targetIndustry" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" placeholder="e.g., EdTech, Finance, SaaS">
            </div>

            <div>
                <label for="idealJobRoles" class="block text-sm font-medium text-gray-700">Ideal Job Roles</label>
                <input type="text" id="idealJobRoles" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" placeholder="e.g., Head of HR, CTO, Growth Manager">
            </div>

            <div>
                <label for="brandVoice" class="block text-sm font-medium text-gray-700">Brand Voice</label>
                <input type="text" id="brandVoice" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" placeholder="e.g., Friendly, Professional, Humorous">
            </div>
            
            <button id="generateBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 font-medium">Generate Message</button>
        </div>

        <!-- Result Section -->
        <div id="result-section" class="hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Generated Message</h2>
            <div id="message-output" class="bg-gray-50 p-6 rounded-lg text-gray-800 border border-gray-200">
                <!-- Message will be displayed here -->
            </div>
            <div id="copy-status" class="mt-2 text-sm text-center font-medium"></div>
            <button id="copyBtn" class="w-full mt-4 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 font-medium">Copy Message</button>
            <button id="backBtn" class="w-full mt-2 bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 font-medium">Generate New Message</button>
        </div>

        <!-- Message Box -->
        <div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white p-6 rounded-xl shadow-lg max-w-sm w-full">
                <h3 class="text-lg font-bold mb-2" id="message-box-title"></h3>
                <p class="text-gray-700 mb-4" id="message-box-content"></p>
                <div class="flex justify-end">
                    <button id="message-box-ok" class="bg-blue-600 text-white py-1 px-4 rounded-md hover:bg-blue-700 transition-colors">OK</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Global variables for Firebase configuration. These are pre-populated by the canvas environment.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        document.addEventListener('DOMContentLoaded', () => {
            const generateBtn = document.getElementById('generateBtn');
            const copyBtn = document.getElementById('copyBtn');
            const backBtn = document.getElementById('backBtn');
            const setupForm = document.getElementById('setup-form');
            const resultSection = document.getElementById('result-section');
            const messageOutput = document.getElementById('message-output');
            const copyStatus = document.getElementById('copy-status');
            const productServiceInput = document.getElementById('productService');
            const targetIndustryInput = document.getElementById('targetIndustry');
            const idealJobRolesInput = document.getElementById('idealJobRoles');
            const brandVoiceInput = document.getElementById('brandVoice');
            const messageBox = document.getElementById('message-box');
            const messageBoxTitle = document.getElementById('message-box-title');
            const messageBoxContent = document.getElementById('message-box-content');
            const messageBoxOk = document.getElementById('message-box-ok');
            
            // Helper function to show a custom message box
            function showMessageBox(title, content) {
                messageBoxTitle.textContent = title;
                messageBoxContent.textContent = content;
                messageBox.classList.remove('hidden');
            }

            // Hide the message box when OK is clicked
            messageBoxOk.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });
            
            // Generate button click handler
            generateBtn.addEventListener('click', async () => {
                const productService = productServiceInput.value.trim();
                const targetIndustry = targetIndustryInput.value.trim();
                const idealJobRoles = idealJobRolesInput.value.trim();
                const brandVoice = brandVoiceInput.value.trim();

                if (!productService || !targetIndustry || !idealJobRoles || !brandVoice) {
                    showMessageBox("Error", "Please fill in all the fields before generating a message.");
                    return;
                }

                generateBtn.disabled = true;
                generateBtn.textContent = 'Generating...';
                generateBtn.classList.add('loading-dots');
                messageOutput.textContent = '';
                copyStatus.textContent = '';

                try {
                    const prompt = `Act as an AI-powered LinkedIn sales automation tool. Generate a hyper-personalized outreach message for a prospect.
                    
                    Here are the campaign details:
                    - Product/Service: ${productService}
                    - Target Industry: ${targetIndustry}
                    - Ideal Job Roles: ${idealJobRoles}
                    - Brand Voice: ${brandVoice}
                    
                    The prospect's details are as follows:
                    - Name: Anjali Mehta
                    - Title: HR Manager
                    - Company: HirePulse
                    - Recent Activity: A recent post about hybrid hiring.
                    
                    The message should be friendly, short, and directly relevant to her recent activity while introducing the product naturally. Do not include any placeholder text. Do not ask "open to a quick chat?".`;

                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    const payload = {
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: {
                            parts: [{ text: "You are an expert copywriter for LinkedIn outreach messages." }]
                        },
                    };
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error: ${errorData.error.message}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (text) {
                        messageOutput.textContent = text;
                        setupForm.classList.add('hidden');
                        resultSection.classList.remove('hidden');
                    } else {
                        showMessageBox("Generation Failed", "Could not generate a message. Please try again.");
                    }

                } catch (error) {
                    console.error('Error generating message:', error);
                    showMessageBox("Generation Failed", `An error occurred while generating the message: ${error.message}`);
                } finally {
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'Generate Message';
                    generateBtn.classList.remove('loading-dots');
                }
            });

            // Copy button click handler
            copyBtn.addEventListener('click', () => {
                const textToCopy = messageOutput.textContent;
                if (textToCopy) {
                    const tempInput = document.createElement('textarea');
                    tempInput.value = textToCopy;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    copyStatus.textContent = "Message copied to clipboard!";
                    copyStatus.classList.add('text-green-600');
                    setTimeout(() => {
                        copyStatus.textContent = '';
                        copyStatus.classList.remove('text-green-600');
                    }, 3000);
                } else {
                    showMessageBox("Nothing to Copy", "There is no message to copy yet. Generate one first!");
                }
            });

            // Back button click handler
            backBtn.addEventListener('click', () => {
                setupForm.classList.remove('hidden');
                resultSection.classList.add('hidden');
                messageOutput.textContent = '';
                copyStatus.textContent = '';
            });

        });
    </script>
</body>
</html>